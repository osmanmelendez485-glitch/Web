<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Registro - Control de Pagos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        .card { border: none; border-radius: 12px; }
        .card-header { border-radius: 12px 12px 0 0 !important; }
        label { font-weight: 700; font-size: 0.85rem; color: #495057; margin-bottom: 5px; }
        .preview-img { max-height: 150px; border-radius: 8px; margin-top: 10px; border: 2px solid #ddd; }
        .bg-total { background-color: #e9ecef; }
        /* Efecto al enfocar inputs */
        .form-control:focus, .form-select:focus {
            border-color: #ffc107;
            box-shadow: 0 0 0 0.25 row rgba(255, 193, 7, 0.25);
        }
    </style>
</head>
<body class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-lg">
                <div class="card-header bg-warning py-3">
                    <h4 class="m-0 text-dark fw-bold">
                        <i class="bi bi-pencil-square"></i> Editar Registro: {{ e.nombre }} {{ e.apellido }}
                    </h4>
                </div>
                <div class="card-body p-4">
                    <form action="/save" method="POST" class="row g-3" enctype="multipart/form-data">
                        <input type="hidden" name="id" value="{{ e.id }}">
                        
                        <div class="col-md-4">
                            <label>Fecha de Registro</label>
                            <input type="date" name="fecha" class="form-control" value="{{ e.fecha }}" required>
                        </div>

                        <div class="col-md-4">
                            <label>Nombre</label>
                            <input type="text" name="nombre" class="form-control" value="{{ e.nombre }}" required>
                        </div>

                        <div class="col-md-4">
                            <label>Apellido</label>
                            <input type="text" name="apellido" class="form-control" value="{{ e.apellido }}">
                        </div>

                        <div class="col-md-4">
                            <label>Cédula / ID Identificación</label>
                            <input type="text" name="cedula" class="form-control" value="{{ e.cedula }}" required>
                        </div>

                        <div class="col-md-4">
                            <label>Número de Contrato</label>
                            <input type="text" name="num_contrato" class="form-control" value="{{ e.num_contrato }}" placeholder="Dejar vacío para auto-generar">
                        </div>
                        
                        <div class="col-md-4">
                            <label>Dirección / Zona</label>
                            <select name="direccion" class="form-select">
                                <option value="Chinandega" {% if e.direccion == 'Chinandega' %}selected{% endif %}>Chinandega</option>
                                <option value="Miguel Jarquín" {% if e.direccion == 'Miguel Jarquín' %}selected{% endif %}>Miguel Jarquín</option>
                                <option value="Módulo 1" {% if e.direccion == 'Módulo 1' %}selected{% endif %}>Módulo 1</option>
                                <option value="Módulo 2" {% if e.direccion == 'Módulo 2' %}selected{% endif %}>Módulo 2</option>
                                <option value="Invercasa SAFI" {% if e.direccion == 'Invercasa SAFI' %}selected{% endif %}>Invercasa SAFI</option>
                            </select>
                        </div>

                        <div class="col-md-12">
                            <label class="text-primary"><i class="bi bi-camera me-1"></i> Actualizar Foto de la Propiedad</label>
                            <input type="file" name="imagen_archivo" class="form-control" accept="image/*">
                            {% if e.foto_url %}
                                <div class="mt-2 text-center bg-light p-2 rounded">
                                    <p class="small text-muted mb-1">Foto actual:</p>
                                    <img src="{{ e.foto_url }}" class="preview-img shadow-sm">
                                </div>
                            {% endif %}
                        </div>

                        <hr class="my-4 text-muted">
                        <h5 class="fw-bold text-primary mb-3"><i class="bi bi-cash-stack"></i> Información de Pagos y Contrato</h5>

                        <div class="col-md-3">
                            <label>Fecha Inicio</label>
                            <input type="date" name="fecha_inicio" class="form-control" value="{{ e.fecha_inicio }}">
                        </div>

                        <div class="col-md-3">
                            <label>Fecha Fin</label>
                            <input type="date" name="fecha_fin" class="form-control" value="{{ e.fecha_fin }}">
                        </div>

                        <div class="col-md-3">
                            <label>Estado de Contrato</label>
                            <select name="estado" class="form-select fw-bold {% if e.estado == 'Cancelado' %}text-success{% else %}text-danger{% endif %}">
                                <option value="Pendiente" {% if e.estado == 'Pendiente' %}selected{% endif %}>⏳ Pendiente</option>
                                <option value="Cancelado" {% if e.estado == 'Cancelado' %}selected{% endif %}>✅ Cancelado</option>
                            </select>
                        </div>

                        <div class="col-md-3">
                            <label class="text-primary">Depósito Inicial (C$)</label>
                            <input type="number" step="0.01" min="0" name="deposito" class="form-control border-primary" value="{{ e.deposito or 0 }}">
                        </div>

                        <div class="col-md-2">
                            <label>Internet (C$)</label>
                            <input type="number" step="0.01" min="0" name="internet" class="calc form-control" value="{{ e.internet or 0 }}">
                        </div>

                        <div class="col-md-2">
                            <label>Agua (C$)</label>
                            <input type="number" step="0.01" min="0" name="agua" class="calc form-control" value="{{ e.agua or 0 }}">
                        </div>

                        <div class="col-md-2">
                            <label>Luz (C$)</label>
                            <input type="number" step="0.01" min="0" name="luz" class="calc form-control" value="{{ e.luz or 0 }}">
                        </div>

                        <div class="col-md-2">
                            <label>Equipo (C$)</label>
                            <input type="number" step="0.01" min="0" name="equipo" class="calc form-control" value="{{ e.equipo or 0 }}">
                        </div>

                        <div class="col-md-4">
                            <label class="text-success fw-bold">Canon Mensual (C$)</label>
                            <input type="number" step="0.01" min="0" name="canon" class="calc form-control border-success" value="{{ e.canon or 0 }}">
                        </div>

                        <div class="col-md-12 mt-3">
                            <div class="p-3 bg-total border rounded d-flex justify-content-between align-items-center">
                                <span class="fw-bold text-muted">Total Mensual Estimado:</span>
                                <h4 class="m-0 fw-bold text-dark" id="total_mensual">C$ 0.00</h4>
                            </div>
                            <small class="text-muted italic">* El total se actualiza automáticamente al cambiar los montos.</small>
                        </div>
                        
                        <div class="col-12 mt-5 d-flex gap-2">
                            <button type="submit" class="btn btn-primary btn-lg w-100 fw-bold shadow-sm">
                                <i class="bi bi-save"></i> Guardar Cambios
                            </button>
                            <a href="/dashboard" class="btn btn-outline-secondary px-4 d-flex align-items-center">
                                Cancelar
                            </a>
                        </div>
                    </form>
                </div>
            </div>
            <p class="text-center mt-3 text-muted small">ID de documento: <code class="user-select-all">{{ e.id }}</code></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Función para calcular el total en tiempo real
        function calcularTotal() {
            let total = 0;
            document.querySelectorAll('.calc').forEach(input => {
                total += parseFloat(input.value) || 0;
            });
            document.getElementById('total_mensual').innerText = 'C$ ' + total.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Escuchar cambios en los inputs de clase .calc
        document.querySelectorAll('.calc').forEach(input => {
            input.addEventListener('input', calcularTotal);
        });

        // Ejecutar cálculo al cargar por primera vez
        window.onload = calcularTotal;
    </script>
</body>
</html>